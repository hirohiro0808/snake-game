<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="theme-color" content="#1a1a2e" />
  <title>è´ªåƒè›‡æ¸¸æˆ</title>
  <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ</text></svg>">
  <style>
    *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;-webkit-user-select:none;user-select:none;touch-action:manipulation}
    html,body{width:100%;height:100%;overflow:hidden;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen-Sans,Ubuntu,Cantarell,sans-serif;background:linear-gradient(135deg,#0f0c29 0%,#302b63 50%,#24243e 100%);color:#fff}
    .container{display:flex;flex-direction:column;align-items:center;justify-content:space-between;height:100vh;max-height:-webkit-fill-available;padding:10px;padding-bottom:env(safe-area-inset-bottom,10px);padding-top:env(safe-area-inset-top,10px)}
    .header{width:100%;text-align:center;padding:10px 0}
    .game-title{font-size:2.2rem;font-weight:800;background:linear-gradient(to right,#00b4db,#0083b0);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:5px;text-shadow:0 2px 5px rgba(0,0,0,.3)}
    .subtitle{color:#a0a0c0;font-size:.9rem}
    .game-area{position:relative;width:95%;max-width:500px;margin:0 auto}
    #gameCanvas{display:block;width:100%;height:auto;background-color:#0a0e27;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.5);border:2px solid rgba(255,255,255,.1)}
    .stats{display:flex;justify-content:space-around;width:95%;max-width:500px;margin:15px auto;background:rgba(255,255,255,.08);border-radius:15px;padding:15px;backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.1)}
    .stat-item{text-align:center;flex:1}
    .stat-label{font-size:.85rem;color:#a0a0c0;margin-bottom:5px}
    .stat-value{font-size:1.8rem;font-weight:700;color:#00b4db}
    .difficulty{display:flex;justify-content:center;margin:15px 0;width:95%;max-width:500px}
    .diff-btn{padding:12px 20px;margin:0 5px;background:rgba(255,255,255,.1);border:none;border-radius:50px;color:#a0a0c0;font-size:.95rem;cursor:pointer;transition:all .2s}
    .diff-btn.active{background:#00b4db;color:#fff;box-shadow:0 4px 10px rgba(0,180,219,.4)}
    .controls{display:flex;flex-direction:column;align-items:center;width:95%;max-width:500px;margin-top:10px}
    .d-pad{display:grid;grid-template-columns:repeat(3,1fr);grid-template-rows:repeat(3,1fr);gap:10px;width:200px;height:200px;margin-bottom:20px}
    .dir-btn{background:rgba(255,255,255,.12);border:none;border-radius:15px;color:#fff;font-size:1.8rem;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .1s;box-shadow:0 4px 8px rgba(0,0,0,.3)}
    .dir-btn:active{transform:scale(.92);background:rgba(0,180,219,.4)}
    .dir-up{grid-column:2;grid-row:1}
    .dir-down{grid-column:2;grid-row:3}
    .dir-left{grid-column:1;grid-row:2}
    .dir-right{grid-column:3;grid-row:2}
    .action-buttons{display:flex;justify-content:space-between;width:100%;margin-top:10px}
    .action-btn{flex:1;margin:0 8px;padding:18px 5px;border:none;border-radius:15px;font-size:1.1rem;font-weight:600;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;box-shadow:0 6px 12px rgba(0,0,0,.3)}
    .action-btn:active{transform:scale(.96)}
    .start-btn{background:linear-gradient(to right,#00b09b,#96c93d);color:#fff}
    .pause-btn{background:linear-gradient(to right,#ff9a00,#ff5e00);color:#fff}
    .game-over{position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.9);display:none;flex-direction:column;justify-content:center;align-items:center;border-radius:12px;z-index:100}
    .game-over-content{text-align:center;padding:30px;background:rgba(26,26,46,.95);border-radius:20px;border:2px solid rgba(0,180,219,.5);max-width:80%}
    .game-over-title{font-size:2.5rem;color:#ff4757;margin-bottom:15px}
    .final-score{font-size:1.8rem;margin-bottom:25px;color:#00b4db}
    .restart-btn{background:linear-gradient(to right,#8e2de2,#4a00e0);color:#fff;padding:18px 30px;border:none;border-radius:15px;font-size:1.2rem;font-weight:600;cursor:pointer;transition:all .2s;box-shadow:0 6px 12px rgba(0,0,0,.3)}
    .restart-btn:active{transform:scale(.96)}
    .instructions{font-size:.8rem;color:rgba(255,255,255,.6);text-align:center;padding:10px;margin-top:10px}
    .tap-start{
      position:absolute;inset:0;display:flex;align-items:center;justify-content:center;
      background:linear-gradient(180deg, rgba(0,0,0,.25), rgba(0,0,0,.55));
      border-radius:12px;z-index:50;pointer-events:none;
    }
    .tap-start .msg{
      background:rgba(10,14,39,.85);
      border:1px solid rgba(255,255,255,.12);
      padding:14px 16px;border-radius:14px;
      box-shadow:0 10px 30px rgba(0,0,0,.45);
      font-weight:700;letter-spacing:.5px;
    }
    @media (max-height:700px){
      .d-pad{width:170px;height:170px;margin-bottom:10px}
      .action-btn{padding:15px 5px;font-size:1rem}
      .stats{padding:12px;margin:10px auto}
      .stat-value{font-size:1.6rem}
    }
    @media (max-width:380px){
      .game-title{font-size:1.9rem}
      .d-pad{width:160px;height:160px}
      .action-buttons{flex-direction:column;gap:10px}
      .action-btn{margin:0}
    }
    @supports (-webkit-touch-callout:none){
      .container{height:-webkit-fill-available}
      .dir-btn,.action-btn,.restart-btn,.diff-btn{-webkit-appearance:none}
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <h1 class="game-title">è´ªåƒè›‡</h1>
      <p class="subtitle">æ»‘åŠ¨å±å¹•æˆ–ä½¿ç”¨æ–¹å‘æŒ‰é’®æ§åˆ¶ï¼ˆå·²æ”¯æŒâ€œä¸€æ»‘å°±åŠ¨â€ï¼‰</p>
    </div>

    <div class="game-area">
      <canvas id="gameCanvas"></canvas>

      <!-- âœ… ä¸€æ»‘å°±åŠ¨æç¤ºå±‚ï¼ˆå¼€å±€åè‡ªåŠ¨éšè—ï¼‰ -->
      <div class="tap-start" id="tapStart">
        <div class="msg">æ»‘åŠ¨ä¸€ä¸‹å¼€å§‹ ğŸ</div>
      </div>

      <div class="game-over" id="gameOverScreen">
        <div class="game-over-content">
          <h2 class="game-over-title">æ¸¸æˆç»“æŸ!</h2>
          <p class="final-score">å¾—åˆ†: <span id="finalScore">0</span></p>
          <button class="restart-btn" id="restartBtn">é‡æ–°å¼€å§‹æ¸¸æˆ</button>
        </div>
      </div>
    </div>

    <div class="stats">
      <div class="stat-item">
        <div class="stat-label">å¾—åˆ†</div>
        <div class="stat-value" id="score">0</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">æœ€é«˜åˆ†</div>
        <div class="stat-value" id="highScore">0</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">é•¿åº¦</div>
        <div class="stat-value" id="length">3</div>
      </div>
    </div>

    <div class="difficulty">
      <button class="diff-btn active" data-speed="150">ç®€å•</button>
      <button class="diff-btn" data-speed="100">ä¸­ç­‰</button>
      <button class="diff-btn" data-speed="70">å›°éš¾</button>
    </div>

    <div class="controls">
      <div class="d-pad">
        <button class="dir-btn dir-up" id="upBtn">â†‘</button>
        <button class="dir-btn dir-down" id="downBtn">â†“</button>
        <button class="dir-btn dir-left" id="leftBtn">â†</button>
        <button class="dir-btn dir-right" id="rightBtn">â†’</button>
      </div>

      <div class="action-buttons">
        <button class="action-btn start-btn" id="startBtn">å¼€å§‹æ¸¸æˆ</button>
        <button class="action-btn pause-btn" id="pauseBtn" disabled>æš‚åœ</button>
      </div>
    </div>

    <div class="instructions">
      æ»‘åŠ¨å±å¹•æˆ–ç‚¹å‡»æ–¹å‘æŒ‰é’®æ§åˆ¶è´ªåƒè›‡ã€‚åƒåˆ°é£Ÿç‰©å¾—åˆ†ï¼Œæ’å¢™æˆ–æ’åˆ°è‡ªå·±æ¸¸æˆç»“æŸã€‚
    </div>
  </div>

  <script>
    // æ¸¸æˆå˜é‡
    let canvas = document.getElementById('gameCanvas');
    let ctx = canvas.getContext('2d');
    let scoreElement = document.getElementById('score');
    let highScoreElement = document.getElementById('highScore');
    let lengthElement = document.getElementById('length');
    let gameOverScreen = document.getElementById('gameOverScreen');
    let finalScoreElement = document.getElementById('finalScore');
    let tapStart = document.getElementById('tapStart');

    // æ§åˆ¶æŒ‰é’®
    let upBtn = document.getElementById('upBtn');
    let downBtn = document.getElementById('downBtn');
    let leftBtn = document.getElementById('leftBtn');
    let rightBtn = document.getElementById('rightBtn');
    let startBtn = document.getElementById('startBtn');
    let pauseBtn = document.getElementById('pauseBtn');
    let restartBtn = document.getElementById('restartBtn');
    let diffButtons = document.querySelectorAll('.diff-btn');

    // æ¸¸æˆå‚æ•°
    let gridSize = 20;
    let speed = 150;
    let score = 0;
    let highScore = localStorage.getItem('snakeHighScore') || 0;
    let gameRunning = false;
    let gameLoop = null;
    let direction = 'right';
    let nextDirection = 'right';

    // è›‡åˆå§‹çŠ¶æ€
    let snake = [
      {x: 10, y: 10},
      {x: 9, y: 10},
      {x: 8, y: 10}
    ];

    // é£Ÿç‰©åˆå§‹ä½ç½®
    let food = {x: 15, y: 15};

    // åˆå§‹åŒ–ç”»å¸ƒ
    function initCanvas() {
      const container = document.querySelector('.game-area');
      const containerWidth = container.clientWidth;

      const gridCount = Math.floor(containerWidth / gridSize);
      canvas.width = gridCount * gridSize;
      canvas.height = canvas.width;

      // æ ¡æ­£é£Ÿç‰©ä½ç½®
      const maxCell = canvas.width / gridSize;
      if (food.x >= maxCell) food.x = Math.floor(maxCell / 2);
      if (food.y >= maxCell) food.y = Math.floor(maxCell / 2);

      drawGame();
    }

    // ç»˜åˆ¶æ¸¸æˆ
    function drawGame() {
      ctx.fillStyle = '#0a0e27';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      drawGrid();
      drawFood();
      drawSnake();
    }

    function drawGrid() {
      ctx.strokeStyle = 'rgba(255, 255, 255, 0.05)';
      ctx.lineWidth = 1;

      for (let x = 0; x <= canvas.width; x += gridSize) {
        ctx.beginPath();
        ctx.moveTo(x, 0);
        ctx.lineTo(x, canvas.height);
        ctx.stroke();
      }
      for (let y = 0; y <= canvas.height; y += gridSize) {
        ctx.beginPath();
        ctx.moveTo(0, y);
        ctx.lineTo(canvas.width, y);
        ctx.stroke();
      }
    }

    function drawFood() {
      ctx.fillStyle = '#ff4757';
      ctx.beginPath();
      ctx.arc(
        food.x * gridSize + gridSize / 2,
        food.y * gridSize + gridSize / 2,
        gridSize / 2 - 2,
        0, Math.PI * 2
      );
      ctx.fill();

      ctx.fillStyle = '#ff6b81';
      ctx.beginPath();
      ctx.arc(
        food.x * gridSize + gridSize / 2 - 3,
        food.y * gridSize + gridSize / 2 - 3,
        3,
        0, Math.PI * 2
      );
      ctx.fill();
    }

    function drawSnake() {
      for (let i = 0; i < snake.length; i++) {
        if (i === 0) {
          ctx.fillStyle = '#00b4db';
          ctx.fillRect(
            snake[i].x * gridSize + 1,
            snake[i].y * gridSize + 1,
            gridSize - 2,
            gridSize - 2
          );

          // çœ¼ç›
          ctx.fillStyle = '#ffffff';
          let eyeX1, eyeY1, eyeX2, eyeY2;
          if (direction === 'right') {
            eyeX1 = snake[i].x * gridSize + gridSize - 7;
            eyeY1 = snake[i].y * gridSize + 7;
            eyeX2 = snake[i].x * gridSize + gridSize - 7;
            eyeY2 = snake[i].y * gridSize + gridSize - 7;
          } else if (direction === 'left') {
            eyeX1 = snake[i].x * gridSize + 7;
            eyeY1 = snake[i].y * gridSize + 7;
            eyeX2 = snake[i].x * gridSize + 7;
            eyeY2 = snake[i].y * gridSize + gridSize - 7;
          } else if (direction === 'up') {
            eyeX1 = snake[i].x * gridSize + 7;
            eyeY1 = snake[i].y * gridSize + 7;
            eyeX2 = snake[i].x * gridSize + gridSize - 7;
            eyeY2 = snake[i].y * gridSize + 7;
          } else { // down
            eyeX1 = snake[i].x * gridSize + 7;
            eyeY1 = snake[i].y * gridSize + gridSize - 7;
            eyeX2 = snake[i].x * gridSize + gridSize - 7;
            eyeY2 = snake[i].y * gridSize + gridSize - 7;
          }
          ctx.beginPath(); ctx.arc(eyeX1, eyeY1, 3, 0, Math.PI * 2); ctx.fill();
          ctx.beginPath(); ctx.arc(eyeX2, eyeY2, 3, 0, Math.PI * 2); ctx.fill();
        } else {
          ctx.fillStyle = i % 2 === 0 ? '#00d4ff' : '#0099cc';
          ctx.fillRect(
            snake[i].x * gridSize + 1,
            snake[i].y * gridSize + 1,
            gridSize - 2,
            gridSize - 2
          );
        }
      }
    }

    // ç§»åŠ¨è›‡
    function moveSnake() {
      direction = nextDirection;
      const head = {x: snake[0].x, y: snake[0].y};

      switch (direction) {
        case 'up': head.y -= 1; break;
        case 'down': head.y += 1; break;
        case 'left': head.x -= 1; break;
        case 'right': head.x += 1; break;
      }

      const maxCell = canvas.width / gridSize;

      // æ’å¢™
      if (head.x < 0 || head.y < 0 || head.x >= maxCell || head.y >= maxCell) {
        gameOver();
        return;
      }

      // æ’è‡ªå·±
      for (let i = 0; i < snake.length; i++) {
        if (snake[i].x === head.x && snake[i].y === head.y) {
          gameOver();
          return;
        }
      }

      snake.unshift(head);

      // åƒåˆ°é£Ÿç‰©
      if (head.x === food.x && head.y === food.y) {
        score += 10;
        scoreElement.textContent = score;
        lengthElement.textContent = snake.length;

        generateFood();

        if (score > highScore) {
          highScore = score;
          highScoreElement.textContent = highScore;
          localStorage.setItem('snakeHighScore', highScore);
        }
      } else {
        snake.pop();
      }

      drawGame();
    }

    function generateFood() {
      let foodOnSnake;
      const maxCell = canvas.width / gridSize;

      do {
        foodOnSnake = false;
        food.x = Math.floor(Math.random() * maxCell);
        food.y = Math.floor(Math.random() * maxCell);

        for (let i = 0; i < snake.length; i++) {
          if (snake[i].x === food.x && snake[i].y === food.y) {
            foodOnSnake = true;
            break;
          }
        }
      } while (foodOnSnake);
    }

    // å¼€å§‹æ¸¸æˆ
    function startGame() {
      if (gameRunning) return;

      gameRunning = true;
      tapStart.style.display = 'none';   // âœ… å¼€å±€éšè—æç¤ºå±‚
      startBtn.disabled = true;
      pauseBtn.disabled = false;

      gameLoop = setInterval(moveSnake, speed);
    }

    // æš‚åœ
    function pauseGame() {
      if (!gameRunning) return;

      gameRunning = false;
      clearInterval(gameLoop);
      gameLoop = null;

      startBtn.disabled = false;
      pauseBtn.disabled = true;
    }

    // é‡æ–°å¼€å§‹
    function restartGame() {
      gameRunning = false;
      clearInterval(gameLoop);
      gameLoop = null;

      snake = [
        {x: 10, y: 10},
        {x: 9, y: 10},
        {x: 8, y: 10}
      ];
      direction = 'right';
      nextDirection = 'right';

      score = 0;
      scoreElement.textContent = score;
      lengthElement.textContent = snake.length;

      generateFood();

      gameOverScreen.style.display = 'none';

      startBtn.disabled = false;
      pauseBtn.disabled = true;

      // âœ… å›åˆ°â€œä¸€æ»‘å°±åŠ¨â€çš„ç­‰å¾…çŠ¶æ€
      tapStart.style.display = 'flex';

      drawGame();
    }

    function gameOver() {
      gameRunning = false;
      clearInterval(gameLoop);
      gameLoop = null;

      finalScoreElement.textContent = score;
      gameOverScreen.style.display = 'flex';

      startBtn.disabled = false;
      pauseBtn.disabled = true;
    }

    // âœ… æ”¹æˆï¼šä¸€æ»‘/ä¸€æŒ‰æ–¹å‘å°±è‡ªåŠ¨å¼€å§‹
    function changeDirection(newDirection) {
      if (!gameRunning) {
        startGame();
      }

      if (
        (newDirection === 'up' && direction !== 'down') ||
        (newDirection === 'down' && direction !== 'up') ||
        (newDirection === 'left' && direction !== 'right') ||
        (newDirection === 'right' && direction !== 'left')
      ) {
        nextDirection = newDirection;
      }
    }

    function setDifficulty(newSpeed) {
      speed = newSpeed;
      if (gameRunning) {
        clearInterval(gameLoop);
        gameLoop = setInterval(moveSnake, speed);
      }
    }

    function init() {
      highScoreElement.textContent = highScore;
      initCanvas();

      window.addEventListener('resize', initCanvas);

      // æ–¹å‘æŒ‰é’®ï¼šç‚¹å‡»å³å¼€å§‹
      upBtn.addEventListener('click', () => changeDirection('up'));
      downBtn.addEventListener('click', () => changeDirection('down'));
      leftBtn.addEventListener('click', () => changeDirection('left'));
      rightBtn.addEventListener('click', () => changeDirection('right'));

      // åŠ¨ä½œæŒ‰é’®ï¼ˆä¿ç•™ï¼‰
      startBtn.addEventListener('click', startGame);
      pauseBtn.addEventListener('click', pauseGame);
      restartBtn.addEventListener('click', restartGame);

      // éš¾åº¦
      diffButtons.forEach(button => {
        button.addEventListener('click', () => {
          diffButtons.forEach(btn => btn.classList.remove('active'));
          button.classList.add('active');
          setDifficulty(parseInt(button.getAttribute('data-speed'), 10));
        });
      });

      // é”®ç›˜ï¼ˆç”µè„‘ï¼‰
      document.addEventListener('keydown', (e) => {
        switch (e.key) {
          case 'ArrowUp': e.preventDefault(); changeDirection('up'); break;
          case 'ArrowDown': e.preventDefault(); changeDirection('down'); break;
          case 'ArrowLeft': e.preventDefault(); changeDirection('left'); break;
          case 'ArrowRight': e.preventDefault(); changeDirection('right'); break;
          case ' ': e.preventDefault(); pauseGame(); break;
        }
      });

      // âœ… è§¦æ‘¸æ»‘åŠ¨ï¼šä¸ç®¡æ˜¯å¦å¼€å§‹ï¼Œéƒ½èƒ½æ»‘ä¸€ä¸‹å¼€å±€
      let touchStartX = 0;
      let touchStartY = 0;

      canvas.addEventListener('touchstart', (e) => {
        touchStartX = e.touches[0].clientX;
        touchStartY = e.touches[0].clientY;
        e.preventDefault();
      }, { passive: false });

      canvas.addEventListener('touchmove', (e) => {
        e.preventDefault();
      }, { passive: false });

      canvas.addEventListener('touchend', (e) => {
        const touchEndX = e.changedTouches[0].clientX;
        const touchEndY = e.changedTouches[0].clientY;

        const dx = touchEndX - touchStartX;
        const dy = touchEndY - touchStartY;

        // è§¦å‘é˜ˆå€¼
        if (Math.abs(dx) > Math.abs(dy)) {
          if (dx > 20) changeDirection('right');
          else if (dx < -20) changeDirection('left');
        } else {
          if (dy > 20) changeDirection('down');
          else if (dy < -20) changeDirection('up');
        }

        e.preventDefault();
      }, { passive: false });

      // åˆå§‹ç»˜åˆ¶ + æ˜¾ç¤ºæç¤ºå±‚
      tapStart.style.display = 'flex';
      drawGame();
    }

    window.addEventListener('load', init);
  </script>
</body>
</html>
